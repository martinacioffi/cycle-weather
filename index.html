<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8"/>
    <title>GPX Route Weather Forecast â€” Dynamic Temp, Breaks, Charts</title>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <!-- Leaflet CSS -->
    <link
            rel="stylesheet"
            href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
            integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
            crossorigin=""
    />
   <link rel="stylesheet" href="./css/style.css">
    <link rel="icon" href="./images/favicon.ico" type="image/x-icon">
    <link rel="icon" type="image/png" sizes="32x32" href="./images/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="./images/favicon-16x16.png">
</head>
<body
        data-sub="Upload GPX â†’ set start time, speed & breaks â†’ see forecast along your route"
        data-demo="true"
        data-compare="true"
>
<header id="header"></header>
<div class="wrap">
    <aside class="side">
        <div class="group">
            <h3>Inputs</h3>

        <div class="gpx-picker">
          <label for="gpxFile" class="help-wrapper">Route (GPX file)
             <button id="gpxHelpBtn" type="button" class="help-btn">?</button>
            </label>
          <div class="gpx-actions">
            <!-- Upload -->
            <button id="uploadBtn" class="uploadBtn" type="button">ðŸ“‚ Upload file</button>
            <input type="file" id="gpxFile" accept=".gpx,application/gpx+xml" style="display:none" />

            <!-- Saved routes dropdown -->
              <label for="savedRoutes"></label><select id="savedRoutes" class="savedRoutes">
              <option value="" disabled selected>ðŸ’¾ Choose from saved</option>
              <!-- options populated dynamically -->
            </select>
          </div>

          <!-- Current route display -->
          <div id="currentRoute" class="current-route">No route selected</div>
        </div>
            <!-- Save option (hidden by default, shown only when logged in) -->
            <div id="saveGpxOption" style="display: none; margin-top: 8px;">
              <button id="saveGpxBtn">Save this GPX file to my account</button>
            </div>
            <!-- Save GPX Feedback Modal -->
            <div id="saveGpxModal" class="modal" style="display:none;">
              <div class="savegpx-modal-content">
                <span id="closeSaveModal" class="close">&times;</span>
                <p id="saveGpxModalMessage"></p>
              </div>
            </div>
            <!-- Hidden pop-out modal -->
            <div id="gpxHelpPopover" class="help-popover">
              <div class="help-popover-content">
                <h2>What is a GPX file?</h2>
                <p>
                    GPX (GPS Exchange Format) files contain route, track, and waypoint data.
                </p>
                <p>
                  You can create one using, for instance:</p>
                  <ul>
                    <li><a href="https://gpx.studio/" target="_blank">GPX Studio</a>
                    <span class="link-note">- fully flexible, create a route from scratch</span>
                    </li>
                    <li><a href="https://mapstogpx.com/" target="_blank">Maps to GPX</a>
                    <span class="link-note">- starting from a Google Maps route</span>
                    </li>
                  </ul>
              </div>
            </div>

            <label for="provider">Weather provider</label>
            <select id="provider">
                <option value="openmeteo" selected>Openâ€‘Meteo (free, no API key)</option>
                <option value="meteoblue">MeteoBlue (requires API key)</option>
            </select>

            <div id="meteoblueKeyRow" style="display:none">
                <label for="meteoblueKey">MeteoBlue API key</label>
                <input type="text" id="meteoblueKey" placeholder="Paste your MeteoBlue API key"/>
            </div>
            <div id="pictogramsProviderRow" style="display:none">
                <label for="pictogramsProvider">Pictograms</label>
                <select id="pictogramsProvider">
                    <option value="yr" selected>Yr</option>
                    <option value="meteoblue" selected>MeteoBlue</option>
                </select>
            </div>

            <label for="startTime">Start time (local)</label>
            <input type="datetime-local" id="startTime"/>

            <div class="row">
                <div>
                    <label for="speed">Average speed (flat terrain)</label>
                    <input type="number" id="speed" min="0" step="0.1" value="14" placeholder="e.g. 20"/>
                </div>
                <div>
                    <label for="speedUnit">Unit</label>
                    <select id="speedUnit">
                        <option value="kmh" selected>km/h</option>
                        <option value="mph">mph</option>
                    </select>
                </div>
            </div>

        <div class="row">
          <div>
            <label for="speedUp">Speed decrease uphill</label>
            <div class="input-with-suffix">
              <input type="number" id="speedUp" min="0" max="100" step="0.1" value="30"/>
              <span class="suffix">%</span>
            </div>
          </div>
          <div>
            <label for="speedDown">Speed increase downhill</label>
            <div class="input-with-suffix">
              <input type="number" id="speedDown" min="0" max="100" step="0.1" value="40"/>
              <span class="suffix">%</span>
            </div>
          </div>
        </div>
            <div class="row">
                <div>
                    <label for="sampleMetersDense">Min sample spacing</label>
                    <select id="sampleMetersDense">
                        <option value="100">100 m</option>
                        <option value="200" selected>200 m</option>
                        <option value="500">500 m</option>
                        <option value="1000">1 km</option>
                    </select>
                </div>
                <div>
                    <label for="sampleMinutesDense">Min time spacing</label>
                    <select id="sampleMinutesDense">
                      <option value="1">1 min</option>
                      <option value="2" selected>2 min</option>
                      <option value="5">5 min</option>
                        <option value="10">10 min</option>
                    </select>
                </div>
            </div>
            <div class="row">
                <div>
                    <label for="sampleMeters">Min sample spacing (icons)</label>
                    <select id="sampleMeters">
                        <option value="2000" selected>2 km</option>
                        <option value="5000">5 km</option>
                        <option value="10000">10 km</option>
                    </select>
                </div>
                <div>
                    <label for="sampleMinutes">Min time spacing (icons)</label>
                    <select id="sampleMinutes">
                      <option value="15" selected>15 min</option>
                      <option value="30">30 min</option>
                      <option value="60">60 min</option>
                    </select>
                </div>
            </div>
            <div class="row">
                <div>
                    <label for="maxCalls">Max API calls</label>
                    <input type="number" id="maxCalls" min="5" max="1000" value="100"/>
                </div>
            </div>

            <div class="group" style="margin-top:10px">
                <h3>Breaks</h3>
                <div id="breaksContainer"></div>
                <button id="addBreakBtn" class="ghost" type="button">+ Add break</button>
                <footer class="note">Breaks delay ETAs after the specified distance. Use km and minutes.</footer>
            </div>

            <button id="processBtn" disabled>Process route & fetch forecast</button>
        </div>
        <div class="group">
            <h3>Stats</h3>
            <div class="stats">
                <div class="stat">
                    <div class="label">Total distance</div>
                    <div class="value" id="statDistance">â€“</div>
                </div>
                <div class="stat">
                    <div class="label">Estimated duration</div>
                    <div class="value" id="statDuration">â€“</div>
                </div>
                <div class="stat">
                    <div class="label">Min / Max temp</div>
                    <div class="value" id="statTempRange">â€“</div>
                </div>
                <div class="stat">
                    <div class="label">Wet share</div>
                    <div class="value" id="statWetShare">â€“</div>
                </div>
            </div>
        </div>

        <div class="group" id="logGroup">
            <h3>Log</h3>
            <div id="log">Load a GPX to begin.</div>
            <footer class="note">Openâ€‘Meteo forecast is free to use. MeteoBlue requires your API key.</footer>
        </div>
        <div class="group" id="aboutMeGroup">
  <h3>About Me</h3>
  <div class="info">
    <p>Hi there - I'm Marti, the creator of this tool.<br>I built it to help my uncle plan his outdoor adventures with smarter weather insights. Hopefully you'll find it helpful too!</p>
    <p>If you have feedback, ideas, or just want to say hello, let's connect!</p>
    <ul>
      <li>LinkedIn: <a href="https://www.linkedin.com/in/martina-cioffi/" target="_blank" class="contact-link">Martina Cioffi</a></li>
        <li>Email: <a href="mailto:martina.cioffi@live.it?subject=Feedback%20on%20GPX%20Tool" class="contact-link">martina.cioffi@live.it</a></li>
      <li>GitHub: <a href="https://github.com/martinacioffi" target="_blank" class="contact-link">martinacioffi</a></li>
    </ul>
  </div>
  <!-- <footer class="note">Thanks for using the app â€” your feedback helps make it better!</footer> -->
</div>
    </aside>
    <div class="main-col">
        <main id="map" style="position: relative;">
        </main>
    <div id="timeSliderContainer">
      <!-- Label -->
      <label for="timeSlider" id="timeSliderMainLabel">Update start time:</label>
      <!-- Slider -->
        <div id="sliderRow">
          <button id="minusStep" class="slider-controls-button">-</button>
          <input type="range" id="timeSlider" min="0" max="1008" step="1">
          <button id="plusStep" class="slider-controls-button">+</button>
      <label id="timeSliderLabel"></label>
                    </div>

      <!-- Step controls -->
      <div class="step-controls" id="jumpButtons">
        <!-- 15 minutes -->
        <div class="step-group">
          <button id="minus10" class="slider-controls-button">-</button>
          <label class="step-label">10 minutes</label>
          <button id="plus10" class="slider-controls-button">+</button>
        </div>

        <!-- 1 hour -->
        <div class="step-group">
          <button id="minus60" class="slider-controls-button">-</button>
          <label class="step-label">1 hour</label>
          <button id="plus60" class="slider-controls-button">+</button>
        </div>

        <!-- 1 day -->
        <div class="step-group">
          <button id="minus1440" class="slider-controls-button">-</button>
          <label class="step-label">1 day</label>
          <button id="plus1440" class="slider-controls-button">+</button>
        </div>
      </div>
    </div>
        <div class="optimize-start">
  <input type="checkbox" id="optimizeStart" disabled>
  <label for="optimizeStart">Optimize start time</label>
</div>
    <!-- Modal -->
    <div id="optimizeModal" class="modal">
      <div class="optimize-modal-content">
        <span class="close">&times;</span>
        <h2>
            Choose optimization parameters
            <a href="./help.html#help-optimize" target="_blank" class="help-icon" title="Read more in Help">?</a>
        </h2>
        <form id="optimizeForm">
          <fieldset id="compareFieldset" class="compare-toggle" hidden>
            <legend class="two-routes">Pick two routes to compare</legend>
                  <div class="route-picker">
                <div class="gpx-picker">
          <label class="help-wrapper">Route 1</label>
          <div class="gpx-actions">
            <button id="route1uploadBtn" class="uploadBtn" type="button">ðŸ“‚ Upload file</button>
            <input type="file" id="route1gpxFile" accept=".gpx,application/gpx+xml" style="display:none" />
              <label for="route1savedRoutes"></label><select id="route1savedRoutes" class="savedRoutes">
              <option value="" disabled selected>ðŸ’¾ Choose from saved</option>
            </select>
          </div>
          <div id="route1currentRoute" class="current-route">No route selected</div>
        </div>
                              <div class="gpx-picker">
          <label class="help-wrapper">Route 2</label>
          <div class="gpx-actions">
            <button id="route2uploadBtn" class="uploadBtn" type="button">ðŸ“‚ Upload file</button>
            <input type="file" id="route2gpxFile" accept=".gpx,application/gpx+xml" style="display:none" />
              <label for="route2savedRoutes"></label><select id="route2savedRoutes" class="savedRoutes">
              <option value="" disabled selected>ðŸ’¾ Choose from saved</option>
            </select>
          </div>
          <div id="route2currentRoute" class="current-route">No route selected</div>
        </div>
        </div>
              <label id="routeError" style="color:red; display:none;"></label>
          </fieldset>
          <fieldset class="time-range">
            <legend class="allowed-range">Allowed start time range</legend>
              <!-- Row 1: Dates -->
              <div class="date-row">
                <div>
                  <label for="optStartDateMin">Earliest date:</label>
                  <input type="date" id="optStartDateMin" name="optStartDateMin">
                </div>
                <div>
                  <label for="optStartDateMax">Latest date:</label>
                  <input type="date" id="optStartDateMax" name="optStartDateMax">
                </div>
              </div>
              <!-- Row 2: Times -->
              <div class="time-row">
                <div>
                  <label for="optStartTimeMin">Earliest time:</label>
                  <input type="time" id="optStartTimeMin" name="optStartTimeMin" value="07:00">
                </div>
                <div>
                  <label for="optStartTimeMax">Latest time:</label>
                  <input type="time" id="optStartTimeMax" name="optStartTimeMax" value="09:00">
                </div>
              </div>
              <label id="rangeError" style="color:red; display:none;"></label>
          </fieldset>
            <fieldset id="singleStartFieldset" class="compare-toggle" hidden>
              <legend class="param-legend">Start time</legend>
              <label for="optSingleStartTime">Select the desired start time:</label>
              <input type="datetime-local" id="optSingleStartTime" name="optSingleStartTime">
            </fieldset>
        <fieldset class="sliders">
          <legend class="param-legend">Optimization weights and thresholds</legend>
          <div class="grid">
            <div class="form-group">
              <label for="rainSlider">
                Minimize precipitation:
                <span id="rainSliderValue" class="slider-value">50%</span>
              </label>
              <input type="range" id="rainSlider" name="rain" min="0" max="100" value="20">
            </div>
            <div class="form-group">
              <label for="maxAcceptableRain">Max acceptable (mm/h)</label>
              <input type="number" id="maxAcceptableRain" min="0" max="50" step="0.1" value="0"/>
            </div>

            <div class="form-group">
              <label for="windMaxSlider">
                Minimize headwind:
                <span id="windMaxSliderValue" class="slider-value">50%</span>
              </label>
              <input type="range" id="windMaxSlider" name="windMax" min="0" max="100" value="20">
            </div>
            <div class="form-group">
              <label for="maxAcceptableWindMax">Max acceptable (km/h)</label>
              <input type="number" id="maxAcceptableWindMax" min="0" max="200" value="10"/>
            </div>

            <div class="form-group">
              <label for="windAvgSlider">
                Minimize avg wind:
                <span id="windAvgSliderValue" class="slider-value">50%</span>
              </label>
              <input type="range" id="windAvgSlider" name="windAvg" min="0" max="100" value="20">
            </div>
            <div class="form-group">
              <label for="maxAcceptableWindAvg">Max acceptable (km/h)</label>
              <input type="number" id="maxAcceptableWindAvg" min="0" max="200" value="15"/>
            </div>

            <div class="form-group">
              <label for="tempSliderHot">
                Minimize hot temperatures:
                <span id="tempSliderHotValue" class="slider-value">50%</span>
              </label>
              <input type="range" id="tempSliderHot" name="temperature" min="0" max="100" value="20">
            </div>
            <div class="form-group">
              <label for="maxAcceptableTemp">Max acceptable (Â°C)</label>
              <input type="number" id="maxAcceptableTemp" min="15" max="50" value="25"/>
            </div>
                  <div class="form-group">
              <label for="tempSliderCold">
                Minimize cold temperatures:
                <span id="tempSliderColdValue" class="slider-value">50%</span>
              </label>
              <input type="range" id="tempSliderCold" name="temperature" min="0" max="100" value="20">
            </div>
            <div class="form-group">
              <label for="minAcceptableTemp">Min acceptable (Â°C)</label>
              <input type="number" id="minAcceptableTemp" min="-20" max="30" value="0"/>
            </div>
          </div>
            <label id="tempRangeError" style="color:red; display:none;"></label>
        </fieldset>
            <fieldset class="granularity">
          <legend class="param-legend">Granularity</legend>
                <label for="granularityMinutes">Check starting times every</label>
                    <select id="granularityMinutes">
                        <option value="10">10 min</option>
                      <option value="20" selected>20 min</option>
                      <option value="30">30 min</option>
                      <option value="60">60 min</option>
                    </select>
        </fieldset>
          <button id= "optimizeButton" type="submit" class="optimize-button">Optimize</button>
            <button id= "compareButton" type="submit" class="compare-toggle" hidden>Find the optimal route</button>
        </form>
      </div>
    </div>
        <div class="charts">
        <h3>Trip forecast</h3>
            <canvas id="tempChart"></canvas>
            <canvas id="precipChart"></canvas>
            <canvas id="windChart"></canvas>
        </div>
    </div>
</div>
<div id="optimizeResultsModal" class="modal">
  <div class="optimize-modal-content">
      <span class="close">&times;</span>
    <h2>Best Starting Times</h2>
      <label>Select a starting time to see details</label>
    <div id="optimizeResultsList"></div>
  </div>
</div>
<div id="progressOverlay" class="progress-overlay" style="display:none;">
  <div class="progress-box">
    <h3 id="progressTitle">Fetching forecastsâ€¦</h3>
    <div class="progress-bar-container">
      <div id="progressBar"></div>
    </div>
    <p id="progressText">0%</p>
  </div>
</div>
<div id="footer"></div>
<script src="./js/common.js"></script>
<!-- Goat Counter for logs and analytics -->
<script data-goatcounter="https://martina-cioffi.goatcounter.com/count" async src="//gc.zgo.at/count.js"></script>
<script src="https://cdn.jsdelivr.net/npm/pako@2.1.0/dist/pako.min.js"></script>
<!-- Firebase core + required services -->
<script src="https://www.gstatic.com/firebasejs/11.0.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/11.0.1/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore-compat.js"></script>
<!-- FirebaseUI for Web -->
<link type="text/css" rel="stylesheet" href="https://www.gstatic.com/firebasejs/ui/6.1.0/firebase-ui-auth.css" />
<script src="https://www.gstatic.com/firebasejs/ui/6.1.0/firebase-ui-auth.js"></script>
<script src="./js/auth.js"></script>
<script type="module" src="./js/settings.js"></script>
<!-- Leaflet JS -->
<script
        src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
        integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
        crossorigin=""
></script>
<!-- Chart.js -->
<link rel="stylesheet" href="https://unpkg.com/leaflet.fullscreen@1.6.0/Control.FullScreen.css" />
<script src="https://unpkg.com/leaflet.fullscreen@1.6.0/Control.FullScreen.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.0.0"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation/dist/chartjs-plugin-annotation.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns@2.0.0"></script>
<script type="module" src="./js/main.js" defer></script>
</body>
</html>