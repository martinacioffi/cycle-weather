<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8"/>
    <title>GPX Route Weather Forecast — Dynamic Temp, Breaks, Charts</title>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <!-- Leaflet CSS -->
    <link
            rel="stylesheet"
            href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
            integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
            crossorigin=""
    />
   <link rel="stylesheet" href="css/style.css">
    <link rel="icon" href="images/favicon.ico" type="image/x-icon">
    <link rel="icon" type="image/png" sizes="32x32" href="images/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="images/favicon-16x16.png">
</head>
<body>
<header>
  <div class="header-content">
    <img src="images/bike.jpg" alt="Logo" class="logo">
    <div>
      <h1>GPX Route Weather Forecast</h1>
      <div class="sub">Upload GPX → set start time, speed & breaks → see forecast along your route</div>
    </div>
  </div>
</header>

<div class="wrap">
    <aside class="side">
        <div class="group">
            <h3>Inputs</h3>

            <label for="gpxFile">GPX file</label>
            <input type="file" id="gpxFile" accept=".gpx,application/gpx+xml,*/*"/>

            <label for="provider">Weather provider</label>
            <select id="provider">
                <option value="openmeteo" selected>Open‑Meteo (free, no API key)</option>
                <option value="meteoblue">MeteoBlue (requires API key)</option>
            </select>

            <div id="meteoblueKeyRow" style="display:none">
                <label for="meteoblueKey">MeteoBlue API key</label>
                <input type="text" id="meteoblueKey" placeholder="Paste your MeteoBlue API key"/>
            </div>

            <label for="startTime">Start time (local)</label>
            <input type="datetime-local" id="startTime"/>

            <div class="row">
                <div>
                    <label for="speed">Average speed</label>
                    <input type="number" id="speed" min="0" step="0.1" placeholder="e.g. 20"/>
                </div>
                <div>
                    <label for="speedUnit">Unit</label>
                    <select id="speedUnit">
                        <option value="kmh" selected>km/h</option>
                        <option value="mph">mph</option>
                    </select>
                </div>
            </div>

            <div class="row">
                <div>
                    <label for="sampleMeters">Min sample spacing (km)</label>
                    <select id="sampleMeters">
                        <option value="2000" selected>2 km</option>
                        <option value="5000">5 km</option>
                        <option value="10000">10 km</option>
                    </select>
                </div>
                <div>
                    <label for="sampleMinutes">Min sample spacing (min)</label>
                    <select id="sampleMinutes">
                      <option value="15" selected>15 min</option>
                      <option value="30">30 min</option>
                      <option value="60">60 min</option>
                    </select>
                </div>
            </div>
            <div class="row">
                <div>
                    <label for="maxCalls">Max API calls</label>
                    <input type="number" id="maxCalls" min="5" max="200" value="60"/>
                </div>
            </div>

            <div class="group" style="margin-top:10px">
                <h3>Breaks</h3>
                <div id="breaksContainer"></div>
                <button id="addBreakBtn" class="ghost" type="button">+ Add break</button>
                <footer class="note">Breaks delay ETAs after the specified distance. Use km and minutes.</footer>
            </div>

            <button id="processBtn" disabled>Process route & fetch forecast</button>

            <div class="legend-temp" id="legendTempBox">
                <div><strong>Track color = temperature (°C)</strong></div>
                <div class="legend-bar" id="legendBar"></div>
                <div class="legend-ticks" id="legendTicks">
                    <span>-</span><span>-</span><span>-</span><span>-</span><span>-</span>
                </div>
            </div>
        </div>

        <div class="group">
            <h3>Stats</h3>
            <div class="stats">
                <div class="stat">
                    <div class="label">Total distance</div>
                    <div class="value" id="statDistance">–</div>
                </div>
                <div class="stat">
                    <div class="label">Estimated duration</div>
                    <div class="value" id="statDuration">–</div>
                </div>
                <div class="stat">
                    <div class="label">Min / Max temp</div>
                    <div class="value" id="statTempRange">–</div>
                </div>
                <div class="stat">
                    <div class="label">Wet share</div>
                    <div class="value" id="statWetShare">–</div>
                </div>
            </div>
        </div>

        <div class="group">
            <h3>Log</h3>
            <div id="log">Load a GPX to begin.</div>
            <footer class="note">Open‑Meteo forecast is UTC hour-aligned. MeteoBlue requires your API key.</footer>
        </div>
    </aside>
    <div class="main-col">
        <main id="map"></main>
        <div class="charts">
            <h3>Trip forecast</h3>
                <canvas id="tempChart"></canvas>
                <canvas id="precipChart"></canvas>
                <canvas id="windChart"></canvas>
        </div>
    </div>
</div>

<!-- Leaflet JS -->
<script
        src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
        integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
        crossorigin=""
></script>
<!-- Chart.js -->
<link rel="stylesheet" href="https://unpkg.com/leaflet.fullscreen@1.6.0/Control.FullScreen.css" />
<script src="https://unpkg.com/leaflet.fullscreen@1.6.0/Control.FullScreen.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.0.0"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation@4.0.1/dist/chartjs-plugin-annotation.umd.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns@2.0.0"></script>
<script type="module" src="js/main.js"></script>
</body>
</html>